/* 2019-6-14 20:07:24 | 版权所有 量子矩阵 */
!function(){function t(t){this._url=null,this._lastFrameTime=null,this._frames=null,this._gifCanvas=document.createElement("canvas"),this._gifCanvas.width=1,this._gifCanvas.height=1,this._gifCtx=null,this._frameIndex=-1,this._gif=null,t.url&&(this.url=t.url)}Object.defineProperties(t.prototype,{url:{get:function(){return this._url},set:function(t){if(this._url=t,this._url){var e=this;Cesium.Resource.fetchArrayBuffer({url:this._url}).then(function(t){e._gif=new gifuct(t),e._frames=e._gif.decompressFrames(!0),e._frameIndex=-1,e._lastFrameTime=null,e._gifCanvas||(e._gifCanvas=document.createElement("canvas")),e._gifCanvas.width=e._frames[0].dims.width,e._gifCanvas.height=e._frames[0].dims.height,e._gifCtx=e._gifCanvas.getContext("2d"),e._gifCtx.clearRect(0,0,e._gifCanvas.width,e._gifCanvas.height)})}else this._frames=null,this._gif=null}}}),t.prototype.destroy=function(){this._frames=null,this._gif=null},t.prototype.renderFrame=function(t){if(t.canvas)this._gifCanvas=t.canvas;else{t.canvas=document.createElement("canvas");var e=Cesium.defaultValue(t.dims.left,0),a=Cesium.defaultValue(t.dims.top,0),i=Cesium.defaultValue(t.dims.width,this._gifCanvas.width),s=Cesium.defaultValue(t.dims.height,this._gifCanvas.height);if(t.canvas.width=i,t.canvas.height=s,0==e&&0==a&&i==this._gifCanvas.width&&s==this._gifCanvas.height){var n=this._gifCtx.getImageData(0,0,i,s);n.data.set(t.patch),this._gifCtx.putImageData(n,0,0)}else{var h;(h=this._tempCv?this._tempCv:document.createElement("canvas")).width=i,h.height=s;var r=h.getContext("2d"),f=r.createImageData(i,s);f.data.set(t.patch),r.putImageData(f,0,0),this._gifCtx.drawImage(h,e,a,i,s)}var m=t.canvas.getContext("2d"),_=m.createImageData(i,s);_.data.set(this._gifCtx.getImageData(0,0,i,s).data),m.putImageData(_,0,0),this._gifCanvas=t.canvas}},t.prototype.getValue=function(t){if(!this._frames||!this._frames.length)return this._gifCanvas;this._currentTime=new Date,this._lastFrameTime||(this._lastFrameTime=new Date);var e=this._currentTime-this._lastFrameTime;return 0<=this._frameIndex?this._frameIndex<this._frames.length?this._frames[this._frameIndex].delay<=e&&(this.renderFrame(this._frames[this._frameIndex]),this._lastFrameTime=this._currentTime,this._frameIndex++):this._frameIndex=0:(this._lastFrameTime=this._currentTime,this._frameIndex=0),this._gifCanvas},qtum3d.GifImageProperty=t}(window);